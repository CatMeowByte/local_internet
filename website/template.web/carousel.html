<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carousel System</title>
</head>
<body>
<main>
 <ul class="carousel-h container-alpha">
  <li>
   <div class="panel-alpha">
    <ul class="carousel-v container-beta">
     <li><div class="panel-beta"><ul class="carousel-h container-omega"><li><div class="panel-omega">1-1-1</div></li><li><div class="panel-omega">1-1-2</div></li><li><div class="panel-omega">1-1-3</div></li></ul></div></li>
     <li><div class="panel-beta"><ul class="carousel-h container-omega"><li><div class="panel-omega">1-2-1</div></li><li><div class="panel-omega">1-2-2</div></li><li><div class="panel-omega">1-2-3</div></li></ul></div></li>
     <li><div class="panel-beta"><ul class="carousel-h container-omega"><li><div class="panel-omega">1-3-1</div></li><li><div class="panel-omega">1-3-2</div></li><li><div class="panel-omega">1-3-3</div></li></ul></div></li>
    </ul>
   </div>
  </li>
  <li>
   <div class="panel-alpha">
    <ul class="carousel-v container-beta">
     <li><div class="panel-beta"><ul class="carousel-h container-omega"><li><div class="panel-omega">2-1-1</div></li><li><div class="panel-omega">2-1-2</div></li><li><div class="panel-omega">2-1-3</div></li></ul></div></li>
     <li><div class="panel-beta"><ul class="carousel-h container-omega"><li><div class="panel-omega">2-2-1</div></li><li><div class="panel-omega">2-2-2</div></li><li><div class="panel-omega">2-2-3</div></li></ul></div></li>
     <li><div class="panel-beta"><ul class="carousel-h container-omega"><li><div class="panel-omega">2-3-1</div></li><li><div class="panel-omega">2-3-2</div></li><li><div class="panel-omega">2-3-3</div></li></ul></div></li>
    </ul>
   </div>
  </li>
  <li>
   <div class="panel-alpha">
    <ul class="carousel-v container-beta">
     <li><div class="panel-beta"><ul class="carousel-h container-omega"><li><div class="panel-omega">3-1-1</div></li><li><div class="panel-omega">3-1-2</div></li><li><div class="panel-omega">3-1-3</div></li></ul></div></li>
     <li><div class="panel-beta"><ul class="carousel-h container-omega"><li><div class="panel-omega">3-2-1</div></li><li><div class="panel-omega">3-2-2</div></li><li><div class="panel-omega">3-2-3</div></li></ul></div></li>
     <li><div class="panel-beta"><ul class="carousel-h container-omega"><li><div class="panel-omega">3-3-1</div></li><li><div class="panel-omega">3-3-2</div></li><li><div class="panel-omega">3-3-3</div></li></ul></div></li>
    </ul>
   </div>
  </li>
 </ul>
</main>
<style>
 *{margin:0;padding:0;box-sizing:border-box;user-select:none;}
 main{width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:#1a1c2c;font-family:monospace;color:#f4f4f4;}
 .carousel-h,.carousel-h>li,.carousel-v,.carousel-v>li{list-style:none;overflow:hidden;display:flex;}
 .carousel-h>li,.carousel-v>li{flex-shrink:0;width:100%;height:100%;}
 .container-alpha,.container-beta,.container-omega{width:100%;height:100%;cursor:grab;border:0.125rem solid #f4f4f4;}
 .container-beta{flex-direction:column;}
 .panel-alpha,.panel-beta,.panel-omega{width:100%;height:100%;display:flex;flex-direction:column;padding:8rem;gap:8rem;}
 .panel-omega{align-items:center;justify-content:center;font-size:4rem;font-weight:bold;background:#333c57;}
</style>
<script>
 (function carousel(){
  const $=id=>document.getElementById(id);
  const $$=(sel,ctx=document)=>ctx.querySelectorAll(sel);
  const $on=(el,evt,fn)=>el.addEventListener(evt,fn);
  const set=(el,key,val)=>el.style.setProperty(key,val);
  const on_raf=fn=>requestAnimationFrame(fn);

  const carousel_behavior=(elem,horiz)=>{
   const ease=0.1,ctr_scl=1,side_scl=0.75,swipe_thr=0.20,drag_thr=10;
   const scroll=()=>horiz?elem.scrollLeft:elem.scrollTop;
   const set_scr=val=>horiz?elem.scrollLeft=val:elem.scrollTop=val;
   const client_sz=()=>horiz?elem.clientWidth:elem.clientHeight;
   const orig_itm=Array.from($$(':scope>li',elem)),cnt=orig_itm.length;
   orig_itm.map(i=>i.cloneNode(true)).reverse().forEach(i=>{i.setAttribute('data-carousel-clone','prev');elem.insertBefore(i,elem.firstChild);});
   orig_itm.map(i=>i.cloneNode(true)).forEach(i=>{i.setAttribute('data-carousel-clone','next');elem.appendChild(i);});
   let size=client_sz();
   set_scr(cnt*size);
   let drag=false,strt=0,scr=scroll(),curr=scroll(),tgt=curr;
   const upd_scl=()=>{const ctr=scroll()+client_sz()/2;$$(':scope>li',elem).forEach((item,i)=>{const dist=Math.abs(ctr-(i*size+size/2))/size;item.style.transform=`scale(${dist<0.5?side_scl+(ctr_scl-side_scl)*(1-dist*2):side_scl})`;});};
   const move=pos=>{if(!drag)return;const delta=pos-strt;set_scr(scr-delta);curr=scroll();upd_scl();wrap();};
   const wrap=()=>{const s=scroll(),wrap_low=(cnt-0.5)*size,wrap_high=(2*cnt-0.5)*size;if(s<wrap_low||s>=wrap_high){const dir=s<wrap_low?1:-1,off=cnt*size*dir;set_scr(s+off);scr+=off;curr+=off;tgt+=off;}};
   const snap=()=>{const move_val=(scroll()-scr)/size,abs_move=Math.abs(move_val),snap_off=(abs_move%1>=swipe_thr?Math.ceil(abs_move):Math.floor(abs_move))*(move_val>=0?1:-1);tgt=(Math.round(scr/size)+snap_off)*size;curr=scroll();};
   const step=()=>{if(!drag){curr+=(tgt-curr)*ease;set_scr(curr);}upd_scl();wrap();on_raf(step);};
   const recalc=()=>{const idx=Math.round(scroll()/size);size=client_sz();set_scr(idx*size);tgt=idx*size;curr=idx*size;upd_scl();};
   $on(window,'resize',recalc);
   recalc();
   step();
   return{elem,horiz,move,snap,set_drg:(s,p)=>{drag=true;scr=s;strt=p;},end_drg:()=>{drag=false;}};
  };
  const caret_map=new Map();
  $$('.carousel-h').forEach(elem=>caret_map.set(elem,carousel_behavior(elem,true)));
  $$('.carousel-v').forEach(elem=>caret_map.set(elem,carousel_behavior(elem,false)));
  let actv_caret=null,drag_sx=0,drag_sy=0,has_mdown=false;
  const init_drag=(evt)=>{const h_caret=evt.target.closest('.carousel-h'),v_caret=evt.target.closest('.carousel-v');if(h_caret||v_caret){actv_caret=null;has_mdown=true;drag_sx=evt.clientX;drag_sy=evt.clientY;evt.preventDefault();}};
  const check_drag=(evt)=>{if(has_mdown&&!actv_caret){const dx=Math.abs(evt.clientX-drag_sx),dy=Math.abs(evt.clientY-drag_sy);if(dx>10||dy>10){has_mdown=false;const is_vert=dy>dx,caret_el=is_vert?evt.target.closest('.carousel-v'):evt.target.closest('.carousel-h');if(caret_el&&caret_map.has(caret_el)){actv_caret=caret_map.get(caret_el);const pos=is_vert?evt.clientY:evt.clientX;actv_caret.set_drg(is_vert?caret_el.scrollTop:caret_el.scrollLeft,pos);}}}if(actv_caret){const pos=actv_caret.horiz?evt.clientX:evt.clientY;actv_caret.move(pos);}};
  const end_drag=()=>{if(actv_caret){actv_caret.snap();actv_caret.end_drg();}actv_caret=null;has_mdown=false;drag_sx=0;drag_sy=0;};
  $on(document,'pointerdown',init_drag);
  $on(document,'pointermove',check_drag);
  $on(document,'pointerup',end_drag);
  $on(document,'contextmenu',e=>e.preventDefault());
 })();
</script>
</body>
</html>